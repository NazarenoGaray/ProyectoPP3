<app-nav-bar></app-nav-bar>

<div class="card container-fluid" id="vista-tecnico">
    <div class="container">
        <div class="card-header row">
            <div class="h3 col-11">Bienvenido</div>
            <div class="h5 col-11">
                <a [routerLink]="'/establecimiento/' + usuario.idUsuario">
                    {{ usuario.nombre }} {{usuario.apellido}} - {{ usuario.rol}}
                </a>
            </div>
        </div>
        <br>
        <div class="card">
            <div class="card-body">
                <h5>Agenda Diaria</h5>
                <ng-container *ngFor="let incidente of usuario.incidentes; let i = index">
                    <!-- Mostrar la fecha solo cuando cambia -->
                    <div *ngIf="i === 0 || incidente.fechaAgenda !== usuario.incidentes[i - 1].fechaAgenda">
                        <h6>{{ incidente.fechaAgenda | date:'dd-MM-yyyy' }}</h6>
                    </div>
                    <div class="table-responsive">
                        <div class="col-md-12">
                            <table class="table table-striped table-fixed-width">
                                <colgroup>
                                    <col style="width: 20%">
                                    <col style="width: 25%">
                                    <col style="width: 20%">
                                    <col style="width: 30%">
                                    <col style="width: 15%">
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th scope="col">Horario Estimado</th>
                                        <th scope="col">Direcci√≥n</th>
                                        <th scope="col">Establecimiento</th>
                                        <th scope="col">Actividad</th>
                                        <th scope="col">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>{{ incidente.horaInicioAgenda }} - {{ incidente.horaFinAgenda }}</td>
                                        <td>{{ incidente.calle}} {{ incidente.altura}} </td>
                                        <td>{{ incidente.nombreEstablecimiento }}</td>
                                        <td>{{ incidente.tarea }}</td>
                                        <td>
                                            <a [routerLink]="'/incidente/' + incidente.idIncidente">Detalles</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </ng-container>
            </div>
        </div>
        <br><br>

        <div class="card">
            <div class="card-body">
                <strong>Incidentes Asociados:</strong>
                <div class="table-responsive ">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Establecimiento</th>
                                <th>Tarea</th>
                                <th>Fecha</th>
                                <th>Categoria</th>
                                <th>Prioridad</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let incidente of usuario.incidentes">
                                <td>{{ incidente.nombreEstablecimiento }}</td>
                                <td>{{ incidente.tarea }}</td>
                                <td>{{ incidente.fechaInicio | date:'dd-MM-yyyy' }}</td>
                                <td>{{ incidente.categoria }}</td>
                                <td>{{ incidente.prioridad }}</td>
                                <td>{{ incidente.estadoIncidente }}</td>
                                <td>
                                    <a [routerLink]="'/incidente/' + incidente.idIncidente">Detalles
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <br><br>

</div>
<app-pie></app-pie>